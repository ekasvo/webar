<!--<!DOCTYPE html>-->
<!--<html>-->

<!--<head>-->
<!--    <meta charset="utf-8">-->
<!--    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">-->
<!--    <title>WEb AR</title>-->
<!--    <link rel="icon" href="/favicon.ico">-->
<!--</head>-->

<!--<script src='https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js'></script>-->
<!--<style>-->
<!--    .arjs-loader {-->
<!--        height: 100%;-->
<!--        width: 100%;-->
<!--        position: absolute;-->
<!--        top: 0;-->
<!--        left: 0;-->
<!--        background-color: rgba(0, 0, 0, 0.8);-->
<!--        z-index: 9999;-->
<!--        display: flex;-->
<!--        justify-content: center;-->
<!--        align-items: center;-->
<!--    }-->
<!--    .arjs-loader div {-->
<!--        text-align: center;-->
<!--        font-size: 1.25em;-->
<!--        color: white;-->
<!--    }-->
<!--</style>-->

<!--&lt;!&ndash; rawgithack development URL &ndash;&gt;-->
<!--<script src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js'></script>-->

<!--<body style='margin : 0px; overflow: hidden;'>-->
<!--&lt;!&ndash; minimal loader shown until image descriptors are loaded &ndash;&gt;-->
<!--<div class="arjs-loader">-->
<!--    <div>Loading, please wait...</div>-->
<!--</div>-->
<!--<a-scene-->
<!--        vr-mode-ui='enabled: false;'-->
<!--        renderer="logarithmicDepthBuffer: true;"-->
<!--        embedded arjs='trackingMethod: best; sourceType: webcam; debugUIEnabled: false;'-->
<!--&gt;-->
<!--    <a-nft-->
<!--            type='nft' url="./webar/trex/marker-image/itech"-->
<!--            smooth='true' smoothCount='10' smoothTolerance='0.01' smoothThreshold='5'>-->
<!--        <a-entity-->
<!--                gltf-model='./trex/pineapple(1)/scene.gltf'-->
<!--                scale="200 200 200"-->
<!--                position="10 10 -5"-->
<!--        >-->
<!--        </a-entity>-->
<!--    </a-nft>-->
<!--    <a-entity camera></a-entity>-->
<!--</a-scene>-->
<!--</body>-->
<!--</html>-->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
    <style>
        .arjs-loader {
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .arjs-loader div {
            text-align: center;
            font-size: 1.25em;
            color: white;
        }
    </style>

</head>

<body style="margin : 0px; overflow: hidden;">
<!-- minimal loader shown until image descriptors are loaded -->
<div class="arjs-loader">
    <div>Loading, please wait...</div>
</div>
<a-scene
        vr-mode-ui="enabled: false;"
        renderer="logarithmicDepthBuffer: true;"
        embedded
        arjs="trackingMethod: best; sourceType: webcam;debugUIEnabled: false;"
        device-orientation-permission-ui="enabled: false"
>
    <!-- we use cors proxy to avoid cross-origin problems -->
    <a-nft
            type="nft"
            url="https://arjs-cors-proxy.herokuapp.com/https://raw.githack.com/AR-js-org/AR.js/master/aframe/examples/image-tracking/nft/trex/trex-image/trex"
            smooth="true"
            smoothCount="10"
            smoothTolerance=".01"
            smoothThreshold="5"
    >
        <a-entity
                gltf-model="https://arjs-cors-proxy.herokuapp.com/https://raw.githack.com/AR-js-org/AR.js/master/aframe/examples/image-tracking/nft/trex/scene.gltf"
                scale="5 5 5"
                position="50 150 0"
        >
        </a-entity>
    </a-nft>
    <a-entity camera></a-entity>
</a-scene>
<canvas id="canvas" hidden></canvas>

<script>
    let sceneEl = document.querySelector('a-scene');
    let counter = 0;

    let shareData;
    document.addEventListener('pointerup', (event) => {
        if (counter%2 !== 0) {
            navigator.share(shareData).then(function(){}).catch(function(err) {alert(err);});
            ++counter;
            return;
        }
        function captureVideos() {
            let canvas = document.getElementById("canvas"); // declare a canvas element in your html
            let ctx = canvas.getContext("2d");
            let videos = document.querySelectorAll("video");
            let i, w, h;

            for (i = 0, len = videos.length; i < len; i++) {
                const v = videos[i];

                try {
                    w = v.videoWidth;
                    h = v.videoHeight;
                    canvas.width = w;
                    canvas.height = h;
                    ctx.fillRect(0, 0, w, h);
                    ctx.drawImage(v, 0, 0, w, h);
                    const a = canvas.toDataURL();
                    v.style.backgroundImage = "url(" + a + ")";
                    ctx.clearRect(0, 0, w, h); // clean the canvas
                    canvas.width = canvas.height = 0;
                } catch(e) {
                    console.log(e);
                }
            }
        }

        captureVideos();
        sceneEl.renderer.render(sceneEl.object3D, sceneEl.camera);
        html2canvas(document.body, {width: document.documentElement.offsetWidth, height: document.documentElement.offsetHeight}).then(function(canvas) {
            function dataURLtoFile(dataurl) {
                let bstr = atob(dataurl.split(',')[1]), n = bstr.length, u8arr = new Uint8Array(n);
                while(n--){
                    u8arr[n] = bstr.charCodeAt(n);
                }
                return u8arr;
            }

            const dataURL = canvas.toDataURL();
            const byteArray = dataURLtoFile(dataURL);
            shareData = {
                files: [new File([byteArray], "bla.png", {type: "image/png"})]
            };
            alert("done");
        }).catch(e => {
            alert(e);
            console.error(e);

        });
        ++counter;
    });
</script>
</body>
</html>